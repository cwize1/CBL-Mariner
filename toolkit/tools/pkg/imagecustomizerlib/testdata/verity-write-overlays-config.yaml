storage:
  disks:
  - partitionTableType: gpt
    maxSize: 6G
    partitions:
    - id: esp
      type: esp
      start: 1M
      end: 9M

    - id: boot
      start: 9M
      end: 108M

    - id: rootfs
      label: rootfs
      start: 108M
      end: 2G

    - id: roothash
      label: roothash
      start: 2G
      end: 3G

    - id: var
      label: var
      start: 3G

  bootType: efi

  fileSystems:
  - deviceId: esp
    type: fat32
    mountPoint:
      path: /boot/efi
      options: umask=0077

  - deviceId: boot
    type: ext4
    mountPoint:
      path: /boot

  - deviceId: rootfs
    type: ext4
    mountPoint:
      path: /

  - deviceId: roothash
    type: fat32

  - deviceId: var
    type: ext4
    mountPoint:
      path: /var

os:
  resetBootLoaderType: hard-reset

  kernelCommandLine:
    extraCommandLine: rd.break

  selinux:
    mode: disabled

  packages:
    install:
    - openssh-server
    - veritysetup
    - vim

  users:
  - name: root
    password:
      type: plain-text
      value: hello

  overlays:
  - target: /etc
    lower: /etc
    upper: /var/overlays/etc/upper
    work: /var/overlays/etc/work
    options: x-systemd.requires-mounts-for=/var

  - target: /home
    lower: /home
    upper: /var/overlays/home/upper
    work: /var/overlays/home/work
    options: x-systemd.requires-mounts-for=/var

  - target: /opt
    lower: /opt
    upper: /var/overlays/opt/upper
    work: /var/overlays/opt/work
    options: x-systemd.requires-mounts-for=/var
    
  - target: /root
    lower: /root
    upper: /var/overlays/root/upper
    work: /var/overlays/root/work
    options: x-systemd.requires-mounts-for=/var

  - target: /usr
    lower: /usr
    upper: /var/overlays/usr/upper
    work: /var/overlays/usr/work
    options: x-systemd.requires-mounts-for=/var

  verity:
    dataPartition:
      idType: part-label
      id: rootfs
    hashPartition:
      idType: part-label
      id: roothash
